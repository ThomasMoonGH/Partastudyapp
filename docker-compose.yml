services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - .:/app
      - /app/node_modules
    expose:
      - "3000"
      - "3001"
    environment:
      - LIVEKIT_API_KEY=${LIVEKIT_API_KEY}
      - LIVEKIT_API_SECRET=${LIVEKIT_API_SECRET}
      - LIVEKIT_HOST=${LIVEKIT_HOST:-wss://partastudyapp-3jhslurr.livekit.cloud}
      - VITE_LIVEKIT_URL=${VITE_LIVEKIT_URL:-wss://partastudyapp-3jhslurr.livekit.cloud}
      - VITE_SUPABASE_URL=https://bkfvtbgalchwoimwtzsu.supabase.co
      - VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrZnZ0YmdhbGNod29pbXd0enN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA4ODgwOTYsImV4cCI6MjA3NjQ2NDA5Nn0.QW9TAXDbPpnutULtCGmSjnM619bP1imq6vSObv6K1nY
    networks:
      - partastudy
    restart: unless-stopped

  nginx:
    image: nginx:1.27-alpine
    depends_on:
      - app
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - certbot-www:/var/www/certbot
      - certbot-certs:/etc/letsencrypt
    networks:
      - partastudy
    restart: unless-stopped

  certbot:
    image: certbot/certbot:latest
    volumes:
      - certbot-www:/var/www/certbot
      - certbot-certs:/etc/letsencrypt
    networks:
      - partastudy
    profiles:
      - certbot

networks:
  partastudy:
    driver: bridge

volumes:
  certbot-www:
  certbot-certs:

