# Changelog - Новые функции

## Исправления и улучшения

### 1. ✅ Исправлена отправка сообщений в чате через "Мои сессии"
- Добавлено автоматическое обновление данных чата при изменении сообщений
- Сообщения теперь отображаются сразу после отправки в диалоговом окне чата

### 2. ✅ Добавление в избранное для прошлых сессий
- Теперь можно добавлять партнёров в избранное не только во время активных сессий, но и из истории завершённых сессий
- Кнопка "Избранное" доступна для всех сессий с партнёрами

### 3. ✅ Страница "Избранные контакты"
- Создана отдельная вкладка "Избранное" в навигации
- Красивое отображение всех избранных партнёров в виде карточек
- Возможность удалить партнёра из избранного
- Быстрые действия: написать сообщение и запланировать сессию

### 4. ✅ Удалена кнопка "Демо сессия"
- Убрана кнопка демо-сессии из десктопной и мобильной навигации
- Удалён соответствующий функционал из Header

### 5. ✅ Админка для модерации
Полноценная панель администратора для модерации жалоб и управления пользователями:

#### Возможности админки:
- **Просмотр жалоб** - все жалобы с фильтрацией по статусу (новые, рассмотренные, решённые)
- **Модерация жалоб** - отметка как "рассмотрено" или блокировка пользователя
- **Управление блокировками** - просмотр заблокированных пользователей и возможность разблокировки
- **Информация о жалобах** - детальная информация о каждой жалобе (кто пожаловался, на кого, причина, детали)

#### Доступ к админке:
- Для получения доступа к админке войдите с email: `admin@parta.app`
- В навигации автоматически появится кнопка "Админка"

#### Серверные endpoints:
- `POST /make-server-85bbbe36/report` - подача жалобы
- `GET /make-server-85bbbe36/admin/reports` - получение всех жалоб
- `GET /make-server-85bbbe36/admin/blocked-users` - получение заблокированных пользователей
- `POST /make-server-85bbbe36/admin/block-user` - блокировка пользователя
- `POST /make-server-85bbbe36/admin/unblock-user` - разблокировка пользователя
- `POST /make-server-85bbbe36/admin/update-report` - обновление статуса жалобы

## Улучшения кода

### Предотвращение дубликатов в избранном
- Использование Set для предотвращения дублирования партнёров в списке избранных

### Синхронизация данных
- Автоматическая синхронизация состояния избранного между сессиями и профилем пользователя

## Новые компоненты

1. **AdminView.tsx** - панель администратора
2. **FavoritesView.tsx** - страница избранных контактов

## Файлы документации

1. **ADMIN_SETUP.md** - инструкция по настройке и использованию админки
2. **CHANGELOG_NEW.md** - этот файл с описанием изменений

## Обновлённые компоненты

1. **Header.tsx** - добавлена вкладка "Избранное" и условная кнопка "Админка"
2. **SessionsView.tsx** - исправлен чат и добавлена кнопка избранного для прошлых сессий
3. **ActiveSession.tsx** - интеграция отправки жалоб на сервер
4. **App.tsx** - интеграция новых вкладок и функционала
5. **/supabase/functions/server/index.tsx** - добавлены endpoints для жалоб и блокировок

## Как протестировать

1. **Чат в "Мои сессии"**: откройте чат любой сессии и отправьте сообщение - оно должно появиться сразу
2. **Избранное из прошлых сессий**: в завершённых сессиях нажмите на кнопку сердца
3. **Страница избранное**: перейдите во вкладку "Избранное" в навигации
4. **Админка**: войдите с email `admin@parta.app` и перейдите во вкладку "Админка"
5. **Жалоба**: во время активной сессии нажмите "Пожаловаться" - жалоба появится в админке
